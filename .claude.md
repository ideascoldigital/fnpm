# FNPM - Unified Package Manager Interface

## Project Overview

FNPM (F*ck NPM) is a unified package manager interface written in Rust that allows teams to standardize their workflow while enabling each developer to use their preferred tool (npm, yarn, pnpm, bun, deno).

**Problem it solves:** Maintain consistent lock files across teams where different developers prefer different package managers, avoiding conflicts and ensuring reproducibility.

## Architecture

### Project Structure

```
fnpm/
├── src/
│   ├── main.rs                  # CLI entry point
│   ├── lib.rs                   # Main library
│   ├── config.rs                # Configuration management (.fnpm/config.json)
│   ├── detector.rs              # Automatic package manager detection
│   ├── doctor.rs                # System diagnostics
│   ├── drama_animation.rs       # Animations and visual feedback
│   ├── hooks.rs                 # Hook system to intercept commands
│   ├── package_manager.rs       # Main trait for package managers
│   └── package_managers/        # Specific implementations
│       ├── mod.rs
│       ├── npm.rs
│       ├── yarn.rs
│       ├── pnpm.rs
│       ├── bun.rs
│       └── deno.rs
├── tests/                       # Integration tests
├── docs/                        # Additional documentation
│   ├── HOOKS.md
│   ├── CI_CD.md
│   ├── CROSS_PLATFORM.md
│   ├── TESTING.md
│   └── WINDOWS_COMPATIBILITY.md
├── Cargo.toml                   # Dependencies configuration
├── Makefile                     # Development commands
└── install.sh                   # Installation script

```

### Key Components

1. **PackageManager Trait** (`package_manager.rs`): Defines the common interface for all package managers
   - Methods: `install()`, `add()`, `remove()`, `run()`, `dlx()`, etc.
   - Lockfile detection
   - Lockfile synchronization

2. **Config** (`config.rs`): Handles project configuration
   - Location: `.fnpm/config.json`
   - Stores: preferred package manager, target lockfile, enabled hooks

3. **Hooks System** (`hooks.rs`): Intercepts native package manager commands
   - Creates shell scripts that redirect commands to fnpm
   - Location: `.fnpm/setup.sh`
   - Allows using `pnpm add` → `fnpm add`

4. **Detector** (`detector.rs`): Automatically detects installed package managers and existing lockfiles

5. **Doctor** (`doctor.rs`): System diagnostics and configuration verification

## Main Dependencies

```toml
clap = "4.5"              # CLI argument parsing
serde = "1.0"             # Serialization
serde_json = "1.0"        # JSON handling
inquire = "0.9"           # Interactive prompts
colored = "3.0"           # Colored output
anyhow = "1.0"            # Error handling
reqwest = "0.12"          # HTTP requests (updates)
semver = "1.0"            # Version parsing
```

## Main Workflow

### 1. Initial Setup
```bash
fnpm setup [npm|yarn|pnpm|bun|deno]
```
- Detects existing lockfiles in the project
- Creates configuration in `.fnpm/config.json`
- Optionally creates hooks in `.fnpm/setup.sh`
- If it detects a different lockfile than selected, configures dual synchronization

### 2. Installation/Adding Packages
```bash
fnpm install
fnpm add <package>
```
- Executes the command with the preferred package manager
- If there's a different target lockfile, automatically synchronizes
- Keeps both lockfiles updated

### 3. Hooks System
```bash
fnpm hooks create   # Create hooks
source .fnpm/setup.sh   # Activate hooks
pnpm add express   # Automatically becomes: fnpm add express
```

## Development

### Available Make Commands

```bash
make setup         # Setup development environment
make dev           # Run fmt + clippy + test
make build         # Compile the project
make test          # Run tests
make test-verbose  # Tests with detailed output
make fmt           # Format code
make clippy        # Lint with clippy
make install       # Install locally
make release       # Compile for release
make clean         # Clean artifacts
```

### Testing

- **Unit Tests**: In each module (`#[cfg(test)]`)
- **Integration Tests**: In `tests/` folder
- **CI/CD**: GitHub Actions with multi-platform tests
- **Coverage**: Integrated with codecov

### Code Standards

- **Formatting**: rustfmt (configured in `.rustfmt.toml`)
- **Linting**: clippy (configured in `clippy.toml`)
- **Commits**: Conventional commits preferred
- **Pre-commit hooks**: Automatic with `make setup`

## Cross-Platform

Supports:
- macOS (Intel and Apple Silicon)
- Linux (x86_64, aarch64)
- Windows (x86_64)

See `docs/CROSS_PLATFORM.md` and `docs/WINDOWS_COMPATIBILITY.md` for details.

## Main Use Cases

### Case 1: PNPM Project with Developer who Prefers Yarn
```bash
cd project-with-pnpm-lock
fnpm setup yarn
# FNPM detects existing pnpm-lock.yaml
fnpm add express
# Result: yarn.lock + pnpm-lock.yaml updated
```

### Case 2: Team with Mixed Preferences
- Developer A uses `fnpm setup npm`
- Developer B uses `fnpm setup pnpm`
- CI/CD uses the project's lockfile
- Everyone maintains the same synchronized lockfile

### Case 3: Gradual Migration
- Legacy project with npm
- Team wants to migrate to pnpm
- Developers can start using pnpm individually
- npm-lock.json is maintained until complete migration

## Key Features to Remember

1. **Smart Lockfile Sync**: Automatically detects and synchronizes different lockfiles
2. **Transparent Hooks**: Developers can use their native commands
3. **Zero Config in CI**: Works without hooks in CI/CD environments
4. **Cross-Platform**: Same behavior across all OS
5. **Interactive Setup**: Guides users through initial configuration

## Next Steps When Working on the Project

1. Always run `make dev` before committing
2. For new features, add tests
3. Update docs if user behavior changes
4. Test on multiple platforms if it's a critical change
5. Verify that hooks still work after changes

## Additional Resources

- README.md: User documentation
- CONTRIBUTING.md: Contributor guide
- docs/HOOKS.md: Hook system details
- docs/TESTING.md: Testing strategy
- docs/CI_CD.md: CI/CD pipeline

## Current Status

- Version: 0.1.1
- Supported package managers: npm, yarn, pnpm, bun, deno
- Status: Production ready
- Test coverage: Integrated with codecov
- CI/CD: GitHub Actions with automatic releases
